---
name: ğŸ§ Ubuntu package
on:
  push:
    branches:
      - master
      - release-**
      - deb
  pull_request:
  release:
    types: ['published']


jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - name: ğŸ£ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”¨ Prepare build env
        run: |
          sudo apt-get update
          sudo apt-get install -y devscripts equivs
          sudo mk-build-deps --install --tool='apt-get -o Debug::pkgProblemResolver=yes --no-install-recommends --yes' debian/control

      - name: ğŸŒ‹ Build
        env:
          NUGET_USERNAME: opengisch
          NUGET_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          dpkg-buildpackage

      - name: ğŸ“‘ Upload dep build logs
        uses: actions/upload-artifact@v3
        if: failure()
        with:
          name: build-logs
          path: |
            ${{ github.workspace }}/**/*.log
